<!--

// file : /data/customTemplates/dashboard/cmd.info.numeric.JaugeHorizontal.html
// Olive 2020-02-10 19:38
// mich0111 2020-02-17 16:27
// OPTIONS : Voir le début de la section script

// de préférence renseignez  les options de la commande min max et unite 

------------------------Paramètres optionnels widget------------------
size      //  taille du cadran (déaut 250px)
nom       // remplace le nom de la commande par celui de votre choix
backlight // Couleur de fond du widget mode light (défaut gray)
backdark // Couleur de fond du widget mode light (défaut white)
fond	    // Couleur de fond du cadran (défaut black )
aiguille	// Couleur aiguille (défaut red)
Laiguille	// Longueur de aiguille (défaut 70)
Eaiguille	// Epaisseur de aiguille (défaut 4)
Raiguille	// longueur arriere de aiguille (défaut 0)
CTXT1	    // Couleur du nom de la commande (défaut green)
CTXT2	    // Couleur de la valeur et de l’unité (défaut red)
fsize     // taille des caractères (défaut 12px)
centre	  // Couleur de l’axe de l’aiguille (défaut white)
Tcentre	  // Taille de l’axe de l’aiguille (défaut 5)
step	    // Espacement entre deux valeurs (défaut 2)
start   	// début cadran (défaut -150 degrés par rapport au nord)
stop	    // fin cadran   (défaut 150 degrés par rapport au nord)

C1	      // Couleur 1ère échelle des valeurs (défaut vert)
C2	      // Couleur 2ème échelle des valeurs (défaut jaune)
C3	      // Couleur 3ème échelle des valeurs (défaut red)
C4      	// Couleur 4ème échelle des valeurs (défaut red)
C5	      // Couleur 5ème echelle des valeurs (défaut red)

V0	      // Valeur de separation entre la partie DEBUT
V1	      // Valeur de separation entre la partie 1 et 2
V2	      // Valeur de separation entre la partie 2 et 3
V3	      // Valeur de separation entre la partie 3 et 4
V4	      // Valeur de separation entre la partie 4 et 5
VX	      // Valeur de separation entre la partie FIN
-------------------------------------------------------------------------


Les expression de couleurs respectent le format HTML (red, lime, …, #F00, …, #000000, …, rgb(255,0,0), …, rgba(255,0,0,0.5) pour des effets de transparence avec le dernier paramètre entre 0 et 1).

-->

<div class="JaugeHorizontal-#id# cmd tooltips cmd-widget #history# widget-JaugeHorizontal" title="" data-type="info" data-subtype="numeric"  data-template="JaugeHorizontal"  data-cmd_id="#id#" >
  <div id="JaugeHorizontal#id#" style="width: 250px ; height: 250px ;"></div>

  <script>

    jeedom.cmd.update['#id#'] = function(_options){

      var nom#id# = ('#nom#' !='#'+'nom#') ? "#nom#":"#name#";                      // remplace le nom de la commande par celui de votre choix
      var size#id# = ('#size#' !='#'+'size#') ? "#size#":"250px";                   // taille du cadran
      var backlight#id# = ('#backlight#' !='#'+'backlight#') ? "#backlight#":"gray";// couleur fond widget exterieur au cadran mode light
      var backdark#id# = ('#backdark#' !='#'+'backdark#') ? "#backdark#":"white";   // couleur fond widget exterieur au cadran mode dark
      var fond#id# = ('#fond#' !='#'+'fond#') ? "#fond#":"black";                   // couleur fond du cadran 
      var aiguille#id# = ('#aiguille#' !='#'+'aiguille#') ? "#aiguille#":"#F00";    // couleur aiguille défaut rouge
      var Laiguille#id# = ('#Laiguille#' !='#'+'Laiguille#') ? "#Laiguille#":"70";  //  Longueur de aiguille
      var Eaiguille#id# = ('#Eaiguille#' !='#'+'Eaiguille#') ? "#Eaiguille#":"4";   //  Epaisseur de aiguille
      var Raiguille#id# = ('#Raiguille#' !='#'+'Raiguille#') ? "#Raiguille#":"0";   //  Longueur arriere de aiguille

      var CTXT1#id#   = ('#CTXT1#'   !='#'+'CTXT1#') ?   "#CTXT1#"  :"green";       // couleur texte 1
      var CTXT2#id#   = ('#CTXT2#'   !='#'+'CTXT2#') ?   "#CTXT2#"  :"red";         // couleur texte 2
      var fsize#id#   = ('#fsize#'   !='#'+'fsize#') ?   "#fsize#"  :"12px";        // taille des caracteres
    
      var centre#id#   = ('#centre#'   !='#'+'centre#') ?   "#centre#"  :"white";   // couleur du centre défaut blanc
      var Tcentre#id#   = ('#Tcentre#'   !='#'+'Tcentre#') ?   "#Tcentre#"  :"5";   // taille du centre

      var step#id#   = ('#step#'   !='#'+'step#') ?   "#step#"  :"2";               // espacement des valeurs 

      var start#id#  = ('#start#'  !='#'+'start#') ?  "#start#" :"-150";            // début compteur
      var stop#id#   = ('#stop#'   !='#'+'stop#') ?   "#stop#"  :"150";             // fin compteur

      var C1#id# = ('#C1#' !='#'+'C1#') ? "#C1#":"#080";                            //VERT  COULEUR 1ER   PARTIE
      var C2#id# = ('#C2#' !='#'+'C2#') ? "#C2#":"#880";                            //JAUNE COULEUR 2IEME PARTIE
      var C3#id# = ('#C3#' !='#'+'C3#') ? "#C3#":"#800";                            //ROUGE COULEUR 3IEME PARTIE
      var C4#id# = ('#C4#' !='#'+'C4#') ? "#C4#":"#800";                            //ROUGE COULEUR 4IEME PARTIE
      var C5#id# = ('#C5#' !='#'+'C5#') ? "#C5#":"#800";                            //ROUGE COULEUR 5IEME PARTIE

      var V0#id# = ('#V0#' !='#'+'V0#') ? "#V0#":"#minValue#";                      // valeur de separation entre la partie 0 et 1
      var V1#id# = ('#V1#' !='#'+'V1#') ? "#V1#":"#minValue#";                      // valeur de separation entre la partie 1 et 2
      var V2#id# = ('#V2#' !='#'+'V2#') ? "#V2#":"#minValue#";                      // valeur de separation entre la partie 2 et 3

      var V3#id# = ('#V3#' !='#'+'V3#') ? "#V3#":"#maxValue#";                      // valeur de separation entre la partie 3 et 4
      var V4#id# = ('#V4#' !='#'+'V4#') ? "#V4#":"#maxValue#";                      // valeur de separation entre la partie 4 et 5
      var VX#id# = ('#VX#' !='#'+'VX#') ? "#VX#":"#maxValue#";                      // valeur de separation entre la partie 5 et 6


      V0#id#=parseFloat(V0#id#);
      V1#id#=parseFloat(V1#id#);
      V2#id#=parseFloat(V2#id#);
      V3#id#=parseFloat(V3#id#);
      V4#id#=parseFloat(V4#id#);
      VX#id#=parseFloat(VX#id#);

      $('#JaugeHorizontal#id#').css('width',size#id#);
      $('#JaugeHorizontal#id#').css('height',size#id#);

      // Sélection du mode clair ou sombre
      var back#id# = "";
      if ($('body')[0].hasAttribute('data-theme')) {
        if ($('body').attr('data-theme').endsWith('Light')) {
          back#id# = backlight#id#;
        } else {
          back#id# = backdark#id#;
        }
      }

      var chart#id#;
      chart#id# = new Highcharts.Chart({

        chart: {
          renderTo: 'JaugeHorizontal#id#',
          type: 'gauge',
            plotBackgroundColor: back#id#,
            plotBackgroundImage: null,
            plotBorderWidth:0,
            plotBorderColor: back#id#,
            plotShadow: false
        },

        title: {
          text: 'test',
          verticalAlign:  'bottom'
        },

        credits: {
          enabled: false
        },

        pane: {
          startAngle: start#id#,
          endAngle:    stop#id#,
          background: [{
            backgroundColor: fond#id#,
            borderWidth: 0,
            outerRadius: '100%',
            innerRadius: '0%'
          }] 
        },

        exporting : {
          enabled: false
        },

        plotOptions: {
          series: {
            dataLabels: {
              enabled: false
            }
          },

          gauge: {
            dial: {
              radius:Laiguille#id#,
              rearLength:Raiguille#id#,
              backgroundColor: aiguille#id#,
              baseWidth:Eaiguille#id#,
              topWidth:1,
              borderWidth: 1,
              borderColor: aiguille#id#
            },

            pivot: {
              radius: Tcentre#id#,
              borderWidth: 1,
              borderColor:centre#id#,
              backgroundColor: centre#id#
            }
          }
        },
        
        // the value axis
        yAxis: {
          min: V0#id#,
          max: VX#id#,
      
          minorTickInterval: 'auto',
          minorTickWidth: 1,
          minorTickLength: 5,
          minorTickPosition: 'inside',
          minorTickColor: 'red',

          tickPixelInterval: 50,
          tickWidth: 2,
          tickPosition: 'inside',
          tickLength: 10,
          tickColor: '#F00',
          labels: {
            step: step#id#,
            rotation: 'auto',
            style: {
              color:'#FFF',
            fontSize: fsize#id#
            }
          },

          title: {
            text: '#state#',
            style: {
              color: 'green',
              fontWeight: 'bold',
              fontSize: fsize#id# 
            },
          },
            
          plotBands: [{
            from: V0#id#,
            to: V1#id#,
            color: C1#id#  // green couleur 1
          }, {
            from: V1#id#,
            to: V2#id#,
            color: C2#id# // yellow couleur 2
          },{
            from: V2#id#,
            to: V3#id#,
            color: C3#id# // yellow couleur 2
          },{
            from: V3#id#,
            to: V4#id#,
            color: C4#id# // yellow couleur 2
          },{
            from: V4#id#,
            to: VX#id#,
            color: C5#id# // red couleur 3
          }]
        },

        series: [{
          name: 'Valeur',
          data: [#state#],
          tooltip: {
            valueSuffix: ' #unite#'
          }
        }]
      }) 
      
      var valeur = parseFloat(_options.display_value);
      var valeur2 = _options.collectDate;    
    
      chart#id#.series[0].data[0].update(valeur);
      
      chart#id#.yAxis[0].setTitle({ text: nom#id# , style: {
        color: CTXT1#id#,
        fontWeight: 'bold',
        fontSize: fsize#id#
      }});
      
      
      chart#id#.setTitle({ text: valeur + ' #unite#', style: {
        color: CTXT2#id#,
        fontSize: fsize#id#
      },y:-60});
    }
      
    jeedom.cmd.update['#id#']({display_value:'#state#',valueDate:'#valueDate#',collectDate:'#collectDate#'});
  </script>
</div>
